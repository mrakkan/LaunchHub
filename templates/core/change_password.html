{% extends 'core/base.html' %}

{% block title %}Change Password{% endblock %}

{% block content %}
<div class="container py-4">
  <div class="row justify-content-center">
    <div class="col-12 col-lg-6">
      <div class="card shadow-sm">
        <div class="card-body">
          <div class="d-flex align-items-center justify-content-between mb-3">
            <h1 class="h4 mb-0"><i class="bi bi-key-fill me-2"></i>Change Password</h1>
            <a href="{% url 'core:profile' %}" class="btn btn-outline-secondary btn-sm"><i class="bi bi-x-lg me-1"></i>Close</a>
          </div>

          <form method="post" class="needs-validation" novalidate>
            {% csrf_token %}

            <div class="mb-3">
              <label for="old_password" class="form-label">Current Password</label>
              <div class="input-group">
                <input type="password" id="old_password" name="old_password" class="form-control" required>
                <button class="btn btn-outline-secondary" type="button" data-toggle-target="#old_password"><i class="bi bi-eye"></i></button>
                <div class="invalid-feedback">Please enter your current password.</div>
              </div>
            </div>

            <div class="mb-3">
              <label for="new_password" class="form-label">New Password</label>
              <div class="input-group">
                <input type="password" id="new_password" name="new_password" class="form-control" required>
                <button class="btn btn-outline-secondary" type="button" data-toggle-target="#new_password"><i class="bi bi-eye"></i></button>
                <div class="invalid-feedback">Please enter a new password (min 8 characters).</div>
              </div>
              <small class="text-muted">Use at least 8 characters, including letters, numbers, and symbols.</small>
            </div>

            <div class="mb-3">
              <label for="confirm_password" class="form-label">Confirm New Password</label>
              <div class="input-group">
                <input type="password" id="confirm_password" name="confirm_password" class="form-control" required>
                <button class="btn btn-outline-secondary" type="button" data-toggle-target="#confirm_password"><i class="bi bi-eye"></i></button>
                <div class="invalid-feedback">Please confirm your new password.</div>
              </div>
            </div>

            <div class="alert alert-info" role="alert">
              <i class="bi bi-info-circle me-2"></i>Password should be at least 8 characters and hard to guess.
            </div>

            <div class="d-flex justify-content-end gap-2">
              <a href="{% url 'core:profile' %}" class="btn btn-outline-secondary">Cancel</a>
              <button type="submit" class="btn btn-primary">Change Password</button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
  </div>
{% endblock %}

{% block extra_js %}
<script>
(function(){
  
  const form = document.querySelector('form.needs-validation');
  if (form) {
    form.addEventListener('submit', function (event) {
      
      const np = document.getElementById('new_password');
      const cp = document.getElementById('confirm_password');
      if (np && cp && np.value !== cp.value) {
        event.preventDefault();
        event.stopPropagation();
        cp.setCustomValidity('Passwords do not match');
      } else if (cp) {
        cp.setCustomValidity('');
      }

      if (!form.checkValidity()) {
        event.preventDefault();
        event.stopPropagation();
      }
      form.classList.add('was-validated');
    }, false);
  }

  
  document.querySelectorAll('[data-toggle-target]').forEach(btn => {
    btn.addEventListener('click', () => {
      const targetSel = btn.getAttribute('data-toggle-target');
      const input = document.querySelector(targetSel);
      if (!input) return;
      const icon = btn.querySelector('i');
      if (input.type === 'password') {
        input.type = 'text';
        if (icon) { icon.classList.remove('bi-eye'); icon.classList.add('bi-eye-slash'); }
      } else {
        input.type = 'password';
        if (icon) { icon.classList.remove('bi-eye-slash'); icon.classList.add('bi-eye'); }
      }
    });
  });
})();
</script>
{% endblock %}